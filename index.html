function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Лист1");

    var lane = parseInt(data.lane);
    if (lane < 1 || lane > 4) {
      return ContentService.createTextOutput(
        JSON.stringify({status: "error", message: "Invalid lane"})
      )
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader("Access-Control-Allow-Origin", "*");
    }

    var row = lane + 1; // F2 = row 2 для lane=1 и т.д.
    sheet.getRange("F" + row).setValue(data.time);

    return ContentService.createTextOutput(
      JSON.stringify({status: "ok"})
    )
    .setMimeType(ContentService.MimeType.JSON)
    .setHeader("Access-Control-Allow-Origin", "*");

  } catch (err) {
    return ContentService.createTextOutput(
      JSON.stringify({status: "error", message: err.toString()})
    )
    .setMimeType(ContentService.MimeType.JSON)
    .setHeader("Access-Control-Allow-Origin", "*");
  }
}

// Обработка preflight-запросов OPTIONS (нужна для CORS)
function doOptions(e) {
  return ContentService.createTextOutput("")
    .setMimeType(ContentService.MimeType.TEXT)
    .setHeader("Access-Control-Allow-Origin", "*")
    .setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS")
    .setHeader("Access-Control-Allow-Headers", "Content-Type");
}
